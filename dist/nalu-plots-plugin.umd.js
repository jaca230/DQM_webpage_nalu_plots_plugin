(function(T,b){typeof exports=="object"&&typeof module<"u"?module.exports=b(require("react")):typeof define=="function"&&define.amd?define(["react"],b):(T=typeof globalThis<"u"?globalThis:T||self,T.NaluPlotsPlugin=b(T.React))})(this,function(T){"use strict";var me=Object.defineProperty;var he=(T,b,j)=>b in T?me(T,b,{enumerable:!0,configurable:!0,writable:!0,value:j}):T[b]=j;var R=(T,b,j)=>he(T,typeof b!="symbol"?b+"":b,j);function b({Plot:l,SettingTypes:u}){var n;return n=class extends l{static get settingSchema(){return{...super.settingSchema,selectedChannel:{type:u.INT,default:0,label:"Channel #",onChange:"onUpdateTick",advanced:!1},dataUrl:{type:u.STRING,default:"http://127.0.0.1:8000/api/json_path?last=1&json_path=/data_products/ChannelIntegralHistogramCollection",label:"Data URL",onChange:"onUpdateTick",advanced:!0}}}formatPlotly(t){var w;const a=(w=t==null?void 0:t.data)==null?void 0:w.arr;if(!Array.isArray(a)||a.length===0)return console.warn("No histograms found or empty array."),{data:[],layout:{}};const s=this.settings.selectedChannel;if(s<0||s>=a.length)return console.warn(`Selected channel ${s} is out of bounds.`),{data:[],layout:{}};const o=a[s];if(!o||!Array.isArray(o.fArray))return console.warn(`Histogram at selected index ${s} is invalid:`,o),{data:[],layout:{}};const c=o.fArray,p=o.fXaxis||{},v=p.fNbins||c.length-2,y=p.fXmin??0,N=((p.fXmax??1)-y)/v,m=[];for(let C=0;C<=v;C++)m.push(y+C*N);const I=[0,...c.slice(1,v+1)];return{data:[{type:"bar",x:m,y:I,name:o.fName||`hist_${s}`,marker:{color:"steelblue"},hoverinfo:"x+y+name",width:N}],layout:{autosize:!0,margin:{t:30,r:20,l:40,b:40},xaxis:{title:"Integral",range:[m[0],m[m.length-1]]},yaxis:{title:"Counts"},bargap:0,legend:{orientation:"h",y:-.2}}}}},R(n,"displayName","Nalu Integral Histogram"),R(n,"name","NaluIntegralHistogram"),n}function j({Plot:l,SettingTypes:u}){var n;return n=class extends l{static get settingSchema(){return{...super.settingSchema,selectedChannel:{type:u.INT,default:0,label:"Channel #",onChange:"onUpdateTick",advanced:!1},dataUrl:{type:u.STRING,default:"http://127.0.0.1:8000/api/json_path?last=1&json_path=/data_products/NaluWaveformCollection",label:"Data URL",onChange:"onUpdateTick",advanced:!0}}}formatPlotly(t){var v;const a=(v=t==null?void 0:t.data)==null?void 0:v.arr;if(!Array.isArray(a)||a.length===0)return console.warn("No waveforms found or empty array."),{data:[],layout:{}};const s=this.settings.selectedChannel,o=a.find(y=>y.channel_num===s);if(!o||!Array.isArray(o.trace))return console.warn(`No waveform found for selected channel ${s}`),{data:[],layout:{}};const c=o.trace.map((y,x)=>x),p=o.trace;return{data:[{type:"scatter",mode:"lines",x:c,y:p,name:`Channel ${s} Trace`,line:{color:"steelblue"},hoverinfo:"x+y+name"}],layout:{autosize:!0,margin:{t:30,r:20,l:40,b:40},xaxis:{title:"Sample Number",range:[0,c.length-1]},yaxis:{title:"ADC Value"},legend:{orientation:"h",y:-.2}}}}},R(n,"displayName","Nalu Waveform Traces"),R(n,"name","NaluWaveformTraces"),n}function Q({Plot:l,SettingTypes:u}){var n;return n=class extends l{static get settingSchema(){return{...super.settingSchema,bufferLength:{type:u.INT,default:20,label:"Buffer Length",onChange:"onBufferResize",advanced:!0},dataUrl:{type:u.STRING,default:"http://127.0.0.1:8000/api/json_path?last=1&json_path=/data_products/NaluTimeCollection",label:"Data URL",onChange:"onUpdateTick",advanced:!0}}}constructor(t){super(t),this.buffer={timestamps:[],data_rate:[],event_time:[],total_time:[],parse_time:[],udp_time:[]}}onBufferResize(){const t=this.settings.bufferLength;Object.keys(this.buffer).forEach(a=>{this.buffer[a]=this.buffer[a].slice(-t)})}formatPlotly(t){var x,N;if(!((N=(x=t==null?void 0:t.data)==null?void 0:x.arr)!=null&&N.length))return{data:[],layout:{}};const a=t.data.arr[0],s=new Date().toISOString();this.buffer.timestamps.push(s),this.buffer.data_rate.push(a.data_rate),this.buffer.event_time.push(a.event_time),this.buffer.total_time.push(a.total_time),this.buffer.parse_time.push(a.parse_time),this.buffer.udp_time.push(a.udp_time);const o=this.settings.bufferLength;Object.keys(this.buffer).forEach(m=>{this.buffer[m]=this.buffer[m].slice(-o)});const c=[{key:"data_rate",label:"Data Rate"},{key:"event_time",label:"Event Time"},{key:"total_time",label:"Total Time"},{key:"parse_time",label:"Parse Time"},{key:"udp_time",label:"UDP Time"}],p=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd"],v=c.map((m,_)=>({type:"scatter",mode:"lines+markers",x:this.buffer.timestamps,y:this.buffer[m.key],name:m.label,xaxis:`x${_+1}`,yaxis:`y${_+1}`,marker:{color:p[_%p.length]},line:{color:p[_%p.length]}})),y={autosize:!0,margin:{t:40,r:20,l:40,b:30},grid:{rows:5,columns:1,pattern:"independent"},legend:{orientation:"h",y:-.2}};return c.forEach((m,_)=>{y[`xaxis${_+1}`]={title:"Time",showgrid:!1},y[`yaxis${_+1}`]={title:m.label,showgrid:!0}}),{data:v,layout:y}}},R(n,"displayName","Nalu Timing Ticker"),R(n,"name","NaluTimingTicker"),n}var O={exports:{}},A={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W;function K(){if(W)return A;W=1;var l=Symbol.for("react.transitional.element"),u=Symbol.for("react.fragment");function n(h,t,a){var s=null;if(a!==void 0&&(s=""+a),t.key!==void 0&&(s=""+t.key),"key"in t){a={};for(var o in t)o!=="key"&&(a[o]=t[o])}else a=t;return t=a.ref,{$$typeof:l,type:h,key:s,ref:t!==void 0?t:null,props:a}}return A.Fragment=u,A.jsx=n,A.jsxs=n,A}var P={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F;function ee(){return F||(F=1,process.env.NODE_ENV!=="production"&&function(){function l(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===ue?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case _:return"Fragment";case w:return"Profiler";case I:return"StrictMode";case oe:return"Suspense";case ie:return"SuspenseList";case ce:return"Activity"}if(typeof e=="object")switch(typeof e.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),e.$$typeof){case m:return"Portal";case ne:return(e.displayName||"Context")+".Provider";case C:return(e._context.displayName||"Context")+".Consumer";case se:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case le:return r=e.displayName||null,r!==null?r:l(e.type)||"Memo";case G:r=e._payload,e=e._init;try{return l(e(r))}catch{}}return null}function u(e){return""+e}function n(e){try{u(e);var r=!1}catch{r=!0}if(r){r=console;var i=r.error,f=typeof Symbol=="function"&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return i.call(r,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",f),u(e)}}function h(e){if(e===_)return"<>";if(typeof e=="object"&&e!==null&&e.$$typeof===G)return"<...>";try{var r=l(e);return r?"<"+r+">":"<...>"}catch{return"<...>"}}function t(){var e=U.A;return e===null?null:e.getOwner()}function a(){return Error("react-stack-top-frame")}function s(e){if(H.call(e,"key")){var r=Object.getOwnPropertyDescriptor(e,"key").get;if(r&&r.isReactWarning)return!1}return e.key!==void 0}function o(e,r){function i(){X||(X=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",r))}i.isReactWarning=!0,Object.defineProperty(e,"key",{get:i,configurable:!0})}function c(){var e=l(this.type);return q[e]||(q[e]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),e=this.props.ref,e!==void 0?e:null}function p(e,r,i,f,k,E,L,$){return i=E.ref,e={$$typeof:N,type:e,key:r,props:E,_owner:k},(i!==void 0?i:null)!==null?Object.defineProperty(e,"ref",{enumerable:!1,get:c}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:L}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:$}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}function v(e,r,i,f,k,E,L,$){var d=r.children;if(d!==void 0)if(f)if(fe(d)){for(f=0;f<d.length;f++)y(d[f]);Object.freeze&&Object.freeze(d)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else y(d);if(H.call(r,"key")){d=l(e);var S=Object.keys(r).filter(function(de){return de!=="key"});f=0<S.length?"{key: someKey, "+S.join(": ..., ")+": ...}":"{key: someKey}",Z[d+f]||(S=0<S.length?"{"+S.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,f,d,S,d),Z[d+f]=!0)}if(d=null,i!==void 0&&(n(i),d=""+i),s(r)&&(n(r.key),d=""+r.key),"key"in r){i={};for(var Y in r)Y!=="key"&&(i[Y]=r[Y])}else i=r;return d&&o(i,typeof e=="function"?e.displayName||e.name||"Unknown":e),p(e,d,E,k,t(),i,L,$)}function y(e){typeof e=="object"&&e!==null&&e.$$typeof===N&&e._store&&(e._store.validated=1)}var x=T,N=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),ne=Symbol.for("react.context"),se=Symbol.for("react.forward_ref"),oe=Symbol.for("react.suspense"),ie=Symbol.for("react.suspense_list"),le=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),ce=Symbol.for("react.activity"),ue=Symbol.for("react.client.reference"),U=x.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,H=Object.prototype.hasOwnProperty,fe=Array.isArray,D=console.createTask?console.createTask:function(){return null};x={"react-stack-bottom-frame":function(e){return e()}};var X,q={},B=x["react-stack-bottom-frame"].bind(x,a)(),J=D(h(a)),Z={};P.Fragment=_,P.jsx=function(e,r,i,f,k){var E=1e4>U.recentlyCreatedOwnerStacks++;return v(e,r,i,!1,f,k,E?Error("react-stack-top-frame"):B,E?D(h(e)):J)},P.jsxs=function(e,r,i,f,k){var E=1e4>U.recentlyCreatedOwnerStacks++;return v(e,r,i,!0,f,k,E?Error("react-stack-top-frame"):B,E?D(h(e)):J)}}()),P}var M;function te(){return M||(M=1,process.env.NODE_ENV==="production"?O.exports=K():O.exports=ee()),O.exports}var g=te();function re({Table:l,SettingTypes:u}){var n;return n=class extends l{static get settingSchema(){return{...super.settingSchema,dataUrl:{type:u.STRING,default:"http://127.0.0.1:8000/api/json_path?last=1&json_path=/data_products/NaluTimeCollection",label:"Data URL",onChange:"onUpdateTick",advanced:!0}}}constructor(t){super(t),this.state={data:null,loading:!0,error:null}}onInit(){this.fetchData()}onUpdateTick(){this.fetchData()}fetchData(){fetch(this.getDataUrl()).then(t=>t.ok?t.json():Promise.reject(`HTTP ${t.status}`)).then(t=>{var s,o;const a=(o=(s=t==null?void 0:t.data)==null?void 0:s.arr)==null?void 0:o[0];if(!a)throw new Error("No data found.");this.setState({data:a,loading:!1,error:null})}).catch(t=>{this.setState({error:t.message,loading:!1})})}render(){const{loading:t,error:a,data:s}=this.state;if(t)return g.jsx("div",{children:"Loading..."});if(a)return g.jsxs("div",{style:{color:"red"},children:["Error: ",a]});if(!s)return g.jsx("div",{children:"No data"});const o=Object.entries(s).filter(([c])=>c!=="_typename"&&c!=="fBits"&&c!=="fUniqueID");return g.jsx("div",{className:"no-drag",style:{overflowX:"auto"},children:g.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[g.jsx("thead",{children:g.jsxs("tr",{children:[g.jsx("th",{style:z,children:"Metric"}),g.jsx("th",{style:z,children:"Value"})]})}),g.jsx("tbody",{children:o.map(([c,p])=>g.jsxs("tr",{children:[g.jsx("td",{style:V,children:c}),g.jsx("td",{style:V,children:p})]},c))})]})})}},R(n,"displayName","Nalu Timing Table"),R(n,"name","NaluTimingTable"),n}const z={borderBottom:"2px solid #ccc",padding:"8px",textAlign:"left",backgroundColor:"#f5f5f5"},V={borderBottom:"1px solid #ddd",padding:"8px"};function ae({registry:l,baseClasses:u}){const{Plot:n,SettingTypes:h,Table:t}=u,a=b({Plot:n,SettingTypes:h}),s=j({Plot:n,SettingTypes:h}),o=Q({Plot:n,SettingTypes:h}),c=re({Table:t,SettingTypes:h});l.register(a.name,a),l.register(s.name,s),l.register(o.name,o),l.register(c.name,c)}return ae});
